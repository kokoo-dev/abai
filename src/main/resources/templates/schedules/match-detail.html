<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <th:block th:replace="~{fragments/head :: headFragment}"></th:block>
    <link rel="stylesheet" th:href="@{/css/schedules/match-detail.css}">
</head>
<body>
    <div class="container">
        <div class="match-header">
            <div class="match-date" th:text="${#temporals.format(match.matchAt.atZoneSameInstant(T(java.time.ZoneId).of('Asia/Seoul')), 'yyyy년 M월 d일 (E) HH:mm', T(java.util.Locale).KOREAN)}">2023년 8월 10일 (목) 15:30</div>
            <div class="match-location">
                <i class="fas fa-map-marker-alt"></i> [[${match.location}]]
            </div>
            <div class="match-address-container">
                <div class="match-address" th:text="${match.address}">상세 주소</div>
                <button class="copy-address-btn">
                    <i class="far fa-copy"></i> 주소 복사
                </button>
            </div>
        </div>

        <div class="match-score-card">
            <div class="team-section home">
                <div class="team-name">ABAI FC</div>
                <div class="team-score" th:text="${match.goalsFor}">0</div>
            </div>
            <div class="score-divider">
                <div th:switch="${match.status}">
                    <div th:case="${T(com.kokoo.abai.core.match.enums.MatchStatus).READY}" class="match-state ready">예정</div>
                    <div th:case="${T(com.kokoo.abai.core.match.enums.MatchStatus).CANCELED}" class="match-state canceled">취소</div>
                    <div th:case="${T(com.kokoo.abai.core.match.enums.MatchStatus).COMPLETED}" class="match-state completed">완료</div>
                </div>
            </div>
            <div class="team-section away">
                <div class="team-name" th:text="${match.opponentName}">상대팀</div>
                <div class="team-score" id="goals-against-text" th:text="${match.goalsAgainst}">0</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" data-tab="lineup">라인업</button>
            <button class="tab-btn" data-tab="record">개인 기록</button>
            <button class="tab-btn" data-tab="participation">참여 현황</button>
            <button class="tab-btn" data-tab="stats">통계</button>
        </div>

        <div class="tab-content active" id="lineup">
            <div class="card">
                <h3 class="section-title">라인업</h3>
                <div class="quarter-tabs">
                    <button class="quarter-tab active" data-quarter="1">1쿼터</button>
                    <button class="quarter-tab" data-quarter="2">2쿼터</button>
                    <button class="quarter-tab" data-quarter="3">3쿼터</button>
                    <button class="quarter-tab" data-quarter="4">4쿼터</button>
                </div>
                <!-- 포메이션 표시 -->
                <div class="formation-display">
                    <span class="formation-text">4-2-3-1</span>
                </div>
                <!-- 축구장 영역 (넓게) -->
                <div class="field-wrapper">
                    <div class="field">
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="record">
            <div class="card">
                <h3 class="section-title">개인 기록</h3>
                <div class="record-stats-grid" id="record-wrapper">
                </div>
            </div>
        </div>

        <div class="tab-content" id="participation">
            <div class="card">
                <h3 class="section-title">참여 현황</h3>
                
                <!-- 전체 참여율 요약 -->
                <div class="participation-summary">
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="summary-content">
                            <div class="summary-value" id="member-participants">0</div>
                            <div class="summary-label">멤버 참여 인원</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="summary-content">
                            <div class="summary-value" id="guest-participants">0</div>
                            <div class="summary-label">용병 참여 인원</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="summary-content">
                            <div class="summary-value" id="participation-rate">0%</div>
                            <div class="summary-label">멤버 참여율</div>
                        </div>
                    </div>
                </div>

                <!-- 쿼터별 참여 현황 -->
                <div class="quarter-participation">
                    <h4 class="subsection-title">쿼터별 참여 현황</h4>
                    <div class="quarter-tabs-participation">
                        <button class="quarter-tab-participation active" data-quarter="1">1쿼터</button>
                        <button class="quarter-tab-participation" data-quarter="2">2쿼터</button>
                        <button class="quarter-tab-participation" data-quarter="3">3쿼터</button>
                        <button class="quarter-tab-participation" data-quarter="4">4쿼터</button>
                    </div>
                </div>

                <!-- 개인별 참여 현황 -->
                <div class="individual-participation">
                    <h4 class="subsection-title">개인별 참여 현황</h4>
                    <div class="individual-stats-grid" id="individual-stats-container">
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="stats">
            <div class="card">
                <h3 class="section-title">경기 통계</h3>
                준비 중입니다..
<!--                <div class="stat-item">-->
<!--                    <div class="stat-label">점유율</div>-->
<!--                    <div class="stat-bars">-->
<!--                        <div class="stat-bar home" style="width: 60%">60%</div>-->
<!--                        <div class="stat-bar away" style="width: 40%">40%</div>-->
<!--                    </div>-->
<!--                </div>-->
            </div>
        </div>

        <div class="action-buttons" sec:authorize="hasAnyAuthority('SERVICE_ADMIN', 'TEAM_ADMIN')">
            <button th:if="${match.status != T(com.kokoo.abai.core.match.enums.MatchStatus).COMPLETED}" class="btn edit-btn">
                <i class="fas fa-edit"></i> 경기 정보 수정
            </button>
            <button class="btn delete-btn">
                <i class="fas fa-trash"></i> 경기 삭제
            </button>
            <button class="btn complete-btn" id="complete-match-btn">
                <i class="fas fa-flag-checkered"></i> 점수 입력
            </button>
        </div>
    </div>

    <!-- 경기 종료 모달 -->
    <div class="modal" id="complete-match-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>점수 입력</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="score-input-section">
                    <h3>최종 스코어</h3>
                    <div class="score-input-container">
                        <div class="team-score-input">
                            <label>ABAI FC</label>
                            <input type="number" id="goals-for" min="0" value="0" readonly>
                        </div>
                        <div class="score-separator">:</div>
                        <div class="team-score-input">
                            <label th:text="${match.opponentName}">상대팀</label>
                            <input type="number" id="goals-against" min="0" value="0">
                        </div>
                    </div>
                </div>

                <div class="player-stats-section">
                    <h3>선수 기록</h3>
                    <div class="player-stats-container" id="player-stats-container">
                        <!-- 선수 기록이 동적으로 추가될 영역 -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn confirm-btn">저장</button>
            </div>
        </div>
    </div>

    <template id="record-card-template">
        <div class="record-card">
            <div class="record-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="record-info">
                <h4 class="record-name">이름</h4>
            </div>
            <div class="record-stats">
                <div class="record-stat-box">
                    <div class="record-stat-value goal">0</div>
                    <div class="record-stat-label">골</div>
                </div>
                <div class="record-stat-box">
                    <div class="record-stat-value assist">0</div>
                    <div class="record-stat-label">어시스트</div>
                </div>
            </div>
        </div>
    </template>

    <template id="player-stats-template">
        <div class="player-stats-item">
            <div class="player-info">
                <span class="player-name"></span>
                <span class="player-number"></span>
            </div>
            <div class="player-stats-inputs">
                <div class="stat-input">
                    <label>골</label>
                    <input type="number" class="goal-input" min="0" value="0">
                </div>
                <div class="stat-input">
                    <label>어시스트</label>
                    <input type="number" class="assist-input" min="0" value="0">
                </div>
            </div>
        </div>
    </template>

    <template id="quarter-content-template">
        <div class="quarter-content">
            <div class="participation-lists">
                <div class="participating-players">
                    <h5>참여 선수</h5>
                    <div class="player-list participation-player-list" id="quarter-1-playing">
                    </div>
                </div>
                <div class="resting-players">
                    <h5>휴식 선수</h5>
                    <div class="player-list rest-player-list" id="quarter-1-resting">
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="quarter-bar-template">
        <div class="quarter-bar">
            <div class="quarter-bar-label"></div>
            <div class="quarter-bar-progress">
                <div class="quarter-bar-fill"></div>
            </div>
            <div class="quarter-bar-value"></div>
        </div>
    </template>

    <template id="participation-player-item-template">
        <div class="player-list-item">
            <div class="player-number">0</div>
            <div class="player-name">홍길동</div>
        </div>
    </template>

    <template id="individual-stat-card-template">
        <div class="individual-stat-card">
            <div class="individual-stat-header">
                <div class="individual-stat-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="individual-stat-info">
                    <h4 class="player-name"></h4>
                    <div class="player-number"></div>
                </div>
            </div>
            <div class="individual-stat-details">
                <div class="individual-stat-item">
                    <div class="stat-value participation-count">1</div>
                    <div class="stat-label">참여 쿼터</div>
                </div>
                <div class="individual-stat-item">
                    <div class="stat-value participation-time">60분</div>
                    <div class="stat-label">총 출전 시간</div>
                </div>
            </div>
            <div class="quarter-participation-bars">

            </div>
        </div>
    </template>

    <template id="quarter-bar-template">
        <div class="quarter-bar">
            <div class="quarter-bar-label">1쿼터</div>
            <div class="quarter-bar-progress">
                <div class="quarter-bar-fill"></div>
            </div>
            <div class="quarter-bar-value">참여</div>
        </div>
    </template>

    <th:block th:replace="~{schedules/position-template :: positionTemplateFragment}"></th:block>

    <th:block th:replace="~{fragments/nav :: navFragment}"></th:block>

    <input type="hidden" id="match-id" name="match-id" th:value="${id}">
    <input type="hidden" id="current-member-id" th:value="${#authentication.principal.id}">
    <input type="hidden" id="total-member-count" th:value="${match.totalMemberCount}">

    <script type="module" th:src="@{/js/schedules/match-detail.js}" defer></script>
</body>
</html> 