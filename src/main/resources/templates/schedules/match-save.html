<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{fragments/head :: headFragment}"></th:block>
    <link rel="stylesheet" th:href="@{/css/match-save.css}">
</head>
<body>
    <div class="container">
        <div class="page-title">
            <h1>경기 설정</h1>
        </div>

        <!-- 경기 정보 입력 폼 (새로 추가) -->
        <div class="match-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="match-date">경기 일자</label>
                    <input type="date" id="match-date" class="form-control">
                </div>
                <div class="form-group">
                    <label for="match-time">경기 시간</label>
                    <input type="time" id="match-time" class="form-control">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="opponent-team">상대팀 이름</label>
                    <input type="text" id="opponent-team" class="form-control" placeholder="상대팀 이름 입력">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group location-group">
                    <label for="match-location">경기 장소</label>
                    <div class="location-input-container">
                        <input type="text" id="match-location" class="form-control location-input" placeholder="경기 장소 입력" readonly>
                        <button id="search-location" class="btn map-search-btn">지도에서 검색</button>
                    </div>
                    <!-- 주소 표시 필드 추가 -->
                    <div class="location-address-container">
                        <input type="text" id="match-address" class="form-control location-address" placeholder="주소" readonly>
                    </div>
                    <!-- 카카오맵 표시 영역 추가 -->
                    <div id="map-container" style="display:none;">
                        <div id="map" style="width:100%;height:300px;"></div>
                        <div class="map-search-box">
                            <input type="text" id="keyword" class="form-control" placeholder="강서 개화 축구장 등 검색">
                            <button id="search-keyword" class="btn">검색</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 선수 선택 영역 (새로 추가) -->
        <div class="player-selection-section">
            <div class="player-selection-header">
                <h3>출전 선수 선택</h3>
                <div class="player-actions">
                    <button id="add-guest-player" class="btn guest-player-btn">용병 추가</button>
                    <div class="player-count">
                        <span id="selected-player-count">0</span> / <span id="total-player-count">0</span> 명 선택됨
                    </div>
                </div>
            </div>
            <div class="player-list-container">
                <div class="player-list" id="player-list">
                    <!-- 선수 목록은 JS로 동적 생성됨 -->
                </div>
            </div>
        </div>

        <!-- 쿼터 선택 탭 -->
        <div class="quarter-tabs">
            <button class="quarter-tab active" data-quarter="1">1쿼터</button>
            <button class="quarter-tab" data-quarter="2">2쿼터</button>
            <button class="quarter-tab" data-quarter="3">3쿼터</button>
            <button class="quarter-tab" data-quarter="4">4쿼터</button>
        </div>

        <!-- 포메이션 선택 -->
        <div class="formation-select-box">
            <label for="formation-select">포메이션</label>
            <select id="formation-select" class="formation-select">
                <option value="4231">4-2-3-1</option>
                <option value="442">4-4-2</option>
                <option value="4411">4-4-1-1</option>
                <option value="433">4-3-3</option>
                <option value="424">4-2-4</option>
                <option value="532">5-3-2</option>
                <option value="352">3-5-2</option>
                <option value="343">3-4-3</option>
            </select>
        </div>

        <!-- 축구장 영역 (넓게) -->
        <div class="field-wrapper">
            <div class="field">
                <!-- 안내 메시지 (축구장 내부 상단) -->
                <div class="field-instruction-inner">
                    <p>포지션을 터치하여 선수를 선택하세요</p>
                </div>
                <!-- JS로 동적 생성됨 -->
            </div>
        </div>
        
        <!-- 저장 버튼 -->
        <div class="save-formation">
            <button class="btn save-btn">경기 정보 저장</button>
        </div>

        <!-- 선수 할당 모달 추가 -->
        <div class="player-select-modal" id="player-select-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>선수 선택</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-player-list">
                    <!-- 선택된 선수 목록만 표시됨 (JS로 동적 생성) -->
                </div>
            </div>
        </div>

        <!-- 용병 추가 모달 -->
        <div class="guest-player-modal" id="guest-player-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>용병 추가</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="guest-player-name">이름</label>
                        <input type="text" id="guest-player-name" class="form-control" placeholder="용병 이름 입력">
                    </div>
                    <div class="form-group modal-actions">
                        <button id="add-guest-player-btn" class="btn add-guest-btn">추가</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <th:block th:replace="~{fragments/nav :: navFragment}"></th:block>

    <template id="place-item-template">
        <div class="place-item">
            <div class="place-item-inner">
                <div class="place-marker"></div>
                <div class="place-info">
                    <h5 class="place-name"></h5>
                    <span class="place-category"></span>
                    <span class="place-address"></span>
                    <span class="place-road-address" style="display: none;"></span>
                    <span class="place-phone" style="display: none;"></span>
                </div>
                <button class="select-place-btn">선택</button>
            </div>
        </div>
    </template>

    <template id="place-info-window-template">
        <div class="place-info-window">
            <div class="place-info-name"></div>
            <div class="place-info-address"></div>
        </div>
    </template>

    <template id="player-card-template">
        <div class="player-card">
            <div class="player-card-number"></div>
            <div class="player-card-name"></div>
        </div>
    </template>

    <template id="positions-container-template">
        <div class="positions-container">
        </div>
    </template>

    <template id="formation-row-template">
        <div class="formation-row">
        </div>
    </template>

    <template id="formation-position-template">
        <div class="formation-position">
        </div>
    </template>

    <template id="empty-position-template">
        <div class="jersey empty-position">
        </div>
    </template>

    <template id="field-instruction-template">
        <div class="field-instruction-inner">
            <p>포지션을 터치하여 선수를 선택하세요</p>
        </div>
    </template>

    <template id="player-number-template">
        <div class="player-number"></div>
    </template>

    <template id="player-name-template">
        <div class="player-name-display"></div>
    </template>

    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=33f6142573a63b0f99ad87db952a8186&libraries=services"></script>
    <script type="module" th:src="@{/js/schedules/match-save.js}" defer></script>
</body>
</html> 